

    #include "./endgame.hpp"


    cEndGame100_base::cEndGame100_base(){
    }


    int32_t cEndGame100_base::eval_push_kg_to_margin(uint8_t stage, uint8_t depth, const uint8_t fields[8][8], uint8_t wkg_x, uint8_t wkg_y, uint8_t bkg_x, uint8_t bkg_y){

        int32_t score = 0;

        if(stage == cMatch::STAGE_ENDGAME_100 || stage == cMatch::STAGE_ENDGAME_110){

            score = 10 - depth;

            uint8_t diffkg = cBoard::max_diff(wkg_x, wkg_y, bkg_x, bkg_y);
            score += (3 - diffkg) * 2;

            uint8_t diff_to_margin = cBoard::diff_to_margin(bkg_x, bkg_y);
            score += (2 - diff_to_margin) * 2 ;

            if(stage == cMatch::STAGE_ENDGAME_100){
                score += cEndGame100::m_single_KG[bkg_y][bkg_x];
            }
            else{
                score += cEndGame110::m_single_KG[bkg_y][bkg_x];
            }
        }
        else{

            score = -10 + depth;

            uint8_t diffkg = cBoard::max_diff(wkg_x, wkg_y, bkg_x, bkg_y);
            score -= (3 - diffkg) * 2;

            uint8_t diff_to_margin = cBoard::diff_to_margin(wkg_x, wkg_y);
            score -= (2 - diff_to_margin) * 2 ;
            
            if(stage == cMatch::STAGE_ENDGAME_120){
                score -= cEndGame100::m_single_KG[wkg_y][wkg_x];
            }
            else{
                score -= cEndGame110::m_single_KG[wkg_y][wkg_x];
            }
        }

        return score;

    }


    // 100 series
    cEndGame100::cEndGame100(){
    }


    const int32_t cEndGame100::m_single_KG[8][8] = {
        { 0,   0,   10,  20,  30,  40,  50,  60 },  // first row
        { 0,   0,   0,   10,  20,  30,  50,  50 },
        { 10,  0,   0,    0,  10,  20,  30,  40 },
        { 20,  10,  0,    0,   0,  10,  20,  30 },
        { 30,  20,  10,   0,   0,   0,  10,  20 },
        { 40,  30,  20,  10,   0,   0,   0,  10 },
        { 50,  50,  30,  20,  10,   0,   0,  0 },
        { 60,  50,  40,  30,  20,  10,   0,  0 }
    };


    // 110 series
    cEndGame110::cEndGame110(){
    }


    const int32_t cEndGame110::m_single_KG[8][8] = {
        { 60,  50,  40,  30,  20,  10,   0,   0 }, // first row
        { 50,  50,  30,  20,  10,   0,   0,   0 },
        { 40,  30,  20,  10,   0,   0,   0,  10 },
        { 30,  20,  10,   0,   0,   0,  10,  20 },
        { 20,  10,   0,   0,   0,  10,  20,  30 },
        { 10,   0,   0,   0,  10,  20,  30,  40 },
        {  0,   0,   0,  10,  20,  30,  50,  50 },
        {  0,   0,  10,  20,  30,  40,  50,  60 }
    };


    // 120 series
    cEndGame120::cEndGame120(){
    }


    const uint64_t cEndGame120::m_path_to_mate[4][5][4] = {
        // bKg_y == 2
        { { 0x00600000B0A00000,
            0x00E0000000000000,
            0x0000000000000000,
            0x0000000000000000 },

          { 0x00066600B000A600,
            0x000E000000000000,
            0x0000000000000000,
            0x0000000000000000 },

          { 0x0000600000B0A000,
            0x0000E00000000000,
            0x0000000000000000,
            0x0000000000000000 },

          { 0x0000060000B000A0,
            0x0B000E00B0000000,
            0x0000000000000000,
            0x0000000000000000 },

          { 0x000000600000BA00,
            0x000B00E000B00A00,
            0x0B0000A0B0000000,
            0x0000000000000000  } },

        // bKg_x == 2
        { { 0x0B00000000000000,
            0x6AE0000000000000,
            0x0000000000000000,
            0x0000000000000000 },

          { 0x0B00000000000000,
            0x0000000060E00000,
            0x6A00000066000000,
            0x0000000000000000 },

          { 0x0000000000000000,
            0x0B00000000000000,
            0x6AE0000000000000,
            0x0000000000000000 },

          { 0x000B000000B00000,
            0x0B00000000000000,
            0x0A00000060E00000,
            0x0000000000000000 },

          { 0x00000B000000B000,
            0x000B000000B00000,
            0x0B0000000A0A0000,
            0x60E0A00000000000 } },

        // bKg_y == 5
        { { 0x0000000000000000,
            0x0000000000000000,
            0x0000000000000E00,
            0x00000A0B00000600 },

          { 0x0000000000000000,
            0x0000000000000000,
            0x000000000000E000,
            0x006A000B00666000 },

          { 0x0000000000000000,
            0x0000000000000000,
            0x00000000000E0000,
            0x000A0B0000060000 },

          { 0x0000000000000000,
            0x0000000000000000,
            0x0000000B00E000B0,
            0x0A000B0000600000 },

          { 0x0000000000000000,
            0x0000000B0A0000B0,
            0x00A00B000E00B000,
            0x00AB000006000000 } },

        // bKg_x == 5
        { { 0x0000000000000000,
            0x0000000000000000,
            0x0000000000000EA6,
            0x00000000000000B0 },

          { 0x0000000000000000,
            0x00000066000000A6,
            0x00000E0600000000,
            0x00000000000000B0 },

          { 0x0000000000000000,
            0x0000000000000EA6,
            0x00000000000000B0,
            0x0000000000000000 },

          { 0x0000000000000000,
            0x00000E06000000A0,
            0x00000000000000B0,
            0x00000B000000B000 },

          { 0x00000000000A0E06,
            0x0000A0A0000000B0,
            0x00000B000000B000,
            0x000B000000B00000 } }
    };


     // 130 series
    cEndGame130::cEndGame130(){
    }


    const uint64_t cEndGame130::m_path_to_mate[4][5][4] = {
        // bKg_y == 2
        { { 0x0000060000000A0B,
            0x00000E0000000000,
            0x0000000000000000,
            0x0000000000000000 },

          { 0x00666000006A000B,
            0x0000E00000000000,
            0x0000000000000000,
            0x0000000000000000 },

          { 0x00060000000A0B00,
            0x000E000000000000,
            0x0000000000000000,
            0x0000000000000000 },

          { 0x006000000A000B00,
            0x00E000B00000000B,
            0x0000000000000000,
            0x0000000000000000 },

          { 0x0600000000AB0000,
            0x0E00B00000A00B00,
            0x0A0000B00000000B,
            0x0000000000000000 } },

        // bKg_x == 2
        { { 0x000000B000000000,
            0x00000EA600000000,
            0x0000000000000000,
            0x0000000000000000 },

          { 0x000000B000000000,
            0x0000000000000E06,
            0x000000A600000066,
            0x0000000000000000 },

          { 0x0000000000000000,
            0x000000B000000000,
            0x00000EA600000000,
            0x0000000000000000 },

          { 0x0000B00000000B00,
            0x000000B000000000,
            0x000000A000000E06,
            0x0000000000000000 },

          { 0x00B00000000B0000,
            0x0000B00000000B00,
            0x000000B00000A0A0,
            0x000A0E0600000000 } },

        // bKg_y == 5
        { { 0x0000000000000000,
            0x0000000000000000,
            0x0000000000E00000,
            0xB0A0000000600000 },

          { 0x0000000000000000,
            0x0000000000000000,
            0x00000000000E0000,
            0xB000A60000066600 },

          { 0x0000000000000000,
            0x0000000000000000,
            0x000000000000E000,
            0x00B0A00000006000 },

          { 0x0000000000000000,
            0x0000000000000000,
            0xB00000000B000E00,
            0x00B000A000000600 },

          { 0x0000000000000000,
            0xB00000000B0000A0,
            0x00B00A00000B00E0,
            0x0000BA0000000060 } },

        // bKg_x == 5
        { { 0x0000000000000000,
            0x0000000000000000,
            0x000000006AE00000,
            0x000000000B000000 },

          { 0x0000000000000000,
            0x660000006A000000,
            0x60E0000000000000,
            0x000000000B000000 },

          { 0x0000000000000000,
            0x000000006AE00000,
            0x000000000B000000,
            0x0000000000000000 },

          { 0x0000000000000000,
            0x60E000000A000000,
            0x000000000B000000,
            0x00B00000000B0000 },

          { 0x0000000060E0A000,
            0x0A0A00000B000000,
            0x00B00000000B0000,
            0x0000B00000000B00 } }
    };

